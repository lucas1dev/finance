openapi: 3.0.0
info:
  title: API do Sistema Financeiro
  description: |
    API completa para gerenciamento de finanças pessoais e empresariais.
    
    ## Funcionalidades Principais
    
    ### Gestão Financeira
    - **Contas**: Gerenciamento de contas bancárias e carteiras
    - **Transações**: Registro de receitas e despesas
    - **Categorias**: Organização de transações por categorias
    - **Relatórios**: Análises e relatórios financeiros
    
    ### Gestão de Clientes e Fornecedores
    - **Clientes**: Cadastro e gestão de clientes
    - **Fornecedores**: Controle de fornecedores
    - **Recebíveis**: Controle de contas a receber
    - **Pagáveis**: Controle de contas a pagar
    
    ### Investimentos e Financiamentos
    - **Investimentos**: Gestão de portfólio de investimentos
    - **Metas de Investimento**: Definição e acompanhamento de metas
    - **Financiamentos**: Controle de empréstimos e financiamentos
    - **Pagamentos**: Gestão de parcelas e pagamentos
    
    ### Recursos Avançados
    - **Autenticação JWT**: Sistema seguro de autenticação
    - **Notificações**: Sistema de alertas e lembretes
    - **Jobs**: Processamento em background
    - **Validações Zod**: Validação robusta de dados com mensagens específicas
    
    ## Validações Implementadas
    
    ### Controllers com Validação Zod
    - ✅ **Autenticação**: Login, registro, recuperação de senha
    - ✅ **Transações**: CRUD completo com validação
    - ✅ **Contas**: Validação de tipos e saldos
    - ✅ **Categorias**: Validação de tipos e cores
    - ✅ **Clientes**: Validação de documentos (CPF/CNPJ)
    - ✅ **Fornecedores**: Validação de documentos e dados
    - ✅ **Pagamentos**: Validação de valores e datas
    - ✅ **Recebíveis**: Validação de clientes e valores
    - ✅ **Pagáveis**: Validação de fornecedores e valores
    - ✅ **Financiamentos**: Validação de cálculos e parcelas
    - ✅ **Investimentos**: Validação de valores e metas
    
    ### Tratamento de Erros
    - **Mensagens Específicas**: Erros de validação com mensagens claras
    - **Códigos HTTP**: Respostas apropriadas (400, 401, 403, 404, 500)
    - **Logs Estruturados**: Logs detalhados para debugging
    - **Middleware Centralizado**: Tratamento uniforme de erros
    
    ## Status dos Testes
    - **43 suítes de teste**: Todas passando ✅
    - **618 testes**: Todos passando ✅
    - **1 teste pulado**: Configuração específica
    - **Execução sequencial**: Implementada para evitar conflitos
    - **Cobertura de código**: Configurada e monitorada
    
    
  version: 2.1.0
  contact:
    name: Suporte Técnico
    email: suporte@finance.com
    url: https://github.com/seu-usuario/finance
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3001
    description: Servidor de Desenvolvimento
  - url: https://api.finance.com
    description: Servidor de Produção

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT obtido através do endpoint de login

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          description: ID único do usuário
        name:
          type: string
          description: Nome completo do usuário
        email:
          type: string
          format: email
          description: Email único do usuário
        role:
          type: string
          enum: [admin, user]
          description: Papel do usuário no sistema
        two_factor_enabled:
          type: boolean
          description: Se a autenticação de dois fatores está ativada
        created_at:
          type: string
          format: date-time
          description: Data de criação do usuário
        updated_at:
          type: string
          format: date-time
          description: Data da última atualização
      required:
        - name
        - email

    Account:
      type: object
      properties:
        id:
          type: integer
          description: ID único da conta
        user_id:
          type: integer
          description: ID do usuário proprietário
        name:
          type: string
          description: Nome da conta
        type:
          type: string
          enum: [checking, savings, investment, credit_card, other]
          description: Tipo da conta
        balance:
          type: number
          format: float
          description: Saldo atual da conta
        description:
          type: string
          description: Descrição adicional da conta
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - name
        - type
        - balance

    Category:
      type: object
      properties:
        id:
          type: integer
          description: ID único da categoria
        user_id:
          type: integer
          description: ID do usuário proprietário
        name:
          type: string
          description: Nome da categoria
        type:
          type: string
          enum: [income, expense]
          description: Tipo da categoria (receita ou despesa)
        color:
          type: string
          description: Cor da categoria em formato hexadecimal (ex: #4CAF50)
        is_default:
          type: boolean
          description: Indica se a categoria é padrão do sistema (não pode ser editada ou excluída)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - name
        - type
        - color
        - is_default
      example:
        id: 1
        user_id: 1
        name: "Salário"
        type: "income"
        color: "#4CAF50"
        is_default: true
        created_at: "2024-06-22T12:00:00Z"
        updated_at: "2024-06-22T12:00:00Z"

    # Exemplo de categoria personalizada
    CategoryPersonal:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        name:
          type: string
        type:
          type: string
        color:
          type: string
        is_default:
          type: boolean
        created_at:
          type: string
        updated_at:
          type: string
      example:
        id: 200
        user_id: 1
        name: "Viagem"
        type: "expense"
        color: "#FF5722"
        is_default: false
        created_at: "2024-06-22T12:00:00Z"
        updated_at: "2024-06-22T12:00:00Z"

    Customer:
      type: object
      properties:
        id:
          type: integer
          description: ID único do cliente
        user_id:
          type: integer
          description: ID do usuário proprietário
        name:
          type: string
          description: Nome do cliente
        document_type:
          type: string
          enum: [CPF, CNPJ]
          description: Tipo do documento
        document_number:
          type: string
          description: Número do documento
        email:
          type: string
          format: email
          description: Email do cliente
        phone:
          type: string
          description: Telefone do cliente
        address:
          type: string
          description: Endereço do cliente
        contact_person:
          type: string
          description: Pessoa de contato
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - name
        - document_type
        - document_number

    Supplier:
      type: object
      properties:
        id:
          type: integer
          description: ID único do fornecedor
        user_id:
          type: integer
          description: ID do usuário proprietário
        name:
          type: string
          description: Nome do fornecedor
        document_type:
          type: string
          enum: [CPF, CNPJ]
          description: Tipo do documento
        document_number:
          type: string
          description: Número do documento
        email:
          type: string
          format: email
          description: Email do fornecedor
        phone:
          type: string
          description: Telefone do fornecedor
        address:
          type: string
          description: Endereço do fornecedor
        contact_person:
          type: string
          description: Pessoa de contato
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - name
        - document_type
        - document_number

    Receivable:
      type: object
      properties:
        id:
          type: integer
          description: ID único do recebível
        user_id:
          type: integer
          description: ID do usuário proprietário
        customer_id:
          type: integer
          description: ID do cliente
        category_id:
          type: integer
          description: ID da categoria
        amount:
          type: number
          format: float
          description: Valor total do recebível
        remaining_amount:
          type: number
          format: float
          description: Valor restante a receber
        due_date:
          type: string
          format: date
          description: Data de vencimento
        description:
          type: string
          description: Descrição do recebível
        status:
          type: string
          enum: [pending, partially_paid, paid]
          description: Status do recebível
        invoice_number:
          type: string
          description: Número da nota fiscal
        payment_terms:
          type: string
          description: Condições de pagamento
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - customer_id
        - category_id
        - amount
        - due_date

    Payment:
      type: object
      properties:
        id:
          type: integer
          description: ID único do pagamento
        receivable_id:
          type: integer
          description: ID do recebível relacionado
        amount:
          type: number
          format: float
          description: Valor do pagamento
        payment_date:
          type: string
          format: date
          description: Data do pagamento
        payment_method:
          type: string
          enum: [cash, pix, credit_card, debit_card, bank_transfer]
          description: Método de pagamento
        description:
          type: string
          description: Descrição do pagamento
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - receivable_id
        - amount
        - payment_date
        - payment_method

    Transaction:
      type: object
      properties:
        id:
          type: integer
          description: ID único da transação
        user_id:
          type: integer
          description: ID do usuário proprietário
        account_id:
          type: integer
          description: ID da conta
        category_id:
          type: integer
          description: ID da categoria
        investment_id:
          type: integer
          description: ID do investimento (opcional)
        fixed_account_id:
          type: integer
          description: ID da conta fixa (opcional)
        type:
          type: string
          enum: [income, expense]
          description: Tipo da transação
        amount:
          type: number
          format: float
          description: Valor da transação
        description:
          type: string
          description: Descrição da transação
        date:
          type: string
          format: date
          description: Data da transação
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - account_id
        - type
        - amount
        - date

    Investment:
      type: object
      properties:
        id:
          type: integer
          description: ID único do investimento
        user_id:
          type: integer
          description: ID do usuário proprietário
        investment_type:
          type: string
          enum: [acoes, fundos, tesouro, cdb, criptomoedas, outros]
          description: Tipo do investimento
        asset_name:
          type: string
          description: Nome do ativo
        ticker:
          type: string
          description: Código do ticker
        invested_amount:
          type: number
          format: float
          description: Valor investido na operação
        quantity:
          type: number
          format: float
          description: Quantidade de ativos
        unit_price:
          type: number
          format: float
          description: Preço unitário
        operation_type:
          type: string
          enum: [compra, venda]
          description: Tipo de operação (compra ou venda)
        operation_date:
          type: string
          format: date
          description: Data da operação
        broker:
          type: string
          enum: [xp_investimentos, rico, clear, modalmais, inter, nubank, itau, bradesco, santander, caixa, outros]
          description: Corretora utilizada
        status:
          type: string
          enum: [ativo, vendido, cancelado]
          description: Status do investimento
        observations:
          type: string
          description: Observações adicionais
        account_id:
          type: integer
          description: ID da conta principal (mantido para compatibilidade)
        source_account_id:
          type: integer
          description: ID da conta bancária de origem (de onde sai o dinheiro)
        destination_account_id:
          type: integer
          description: ID da conta bancária de destino (onde fica o investimento)
        category_id:
          type: integer
          description: ID da categoria do investimento
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - investment_type
        - asset_name
        - invested_amount
        - quantity
        - operation_type
        - operation_date
        - source_account_id
        - destination_account_id

    Notification:
      type: object
      properties:
        id:
          type: integer
          description: ID único da notificação
        user_id:
          type: integer
          description: ID do usuário
        title:
          type: string
          description: Título da notificação
        message:
          type: string
          description: Mensagem da notificação
        type:
          type: string
          enum: [payment_due, payment_overdue, reminder, system]
          description: Tipo da notificação
        relatedType:
          type: string
          enum: [financing, financing_payment, creditor, general]
          description: Tipo de entidade relacionada
        relatedId:
          type: integer
          description: ID da entidade relacionada
        dueDate:
          type: string
          format: date-time
          description: Data de vencimento
        priority:
          type: string
          enum: [low, medium, high, urgent]
          description: Prioridade da notificação
        isRead:
          type: boolean
          description: Se foi lida
                  description: Se deve limpar notificações existentes antes de reprocessar
                  default: false
                  example: true
              required:
                - targetUserId
      responses:
        '200':
          description: Notificações reprocessadas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      targetUserId:
                        type: integer
                        description: ID do usuário alvo
                        example: 123
                      notificationType:
                        type: string
                        description: Tipo de notificação reprocessada
                        example: payment_check
                      clearExisting:
                        type: boolean
                        description: Se notificações existentes foram limpas
                        example: true
                      notificationsCreated:
                        type: integer
                        description: Número de notificações criadas
                        example: 5
                      notificationsRemoved:
                        type: integer
                        description: Número de notificações removidas
                        example: 2
                      jobsExecuted:
                        type: array
                        items:
                          type: string
                        description: Jobs executados
                        example: ["payment_check"]
                  message:
                    type: string
                    example: "Notificações reprocessadas com sucesso para o usuário João Silva"
        '400':
          description: Dados inválidos
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "ID do usuário alvo é obrigatório"
        '401':
          description: Não autorizado
        '404':
          description: Usuário alvo não encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: string
                    example: "Usuário alvo não encontrado"

  # Endpoints de Jobs de Notificação
  /api/notifications/jobs/payment-check:
    post:
      tags:
        - NotificationJobs
      summary: Executar job de verificação de pagamentos
      description: Executa apenas o job de verificação de pagamentos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Job executado com sucesso

  /api/notifications/jobs/general-reminders:
    post:
      tags:
        - NotificationJobs
      summary: Executar job de lembretes gerais
      description: Executa apenas o job de lembretes gerais
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Job executado com sucesso

  /api/notifications/jobs/cleanup:
    post:
      tags:
        - NotificationJobs
      summary: Executar limpeza de notificações
      description: Executa a limpeza de notificações antigas (apenas administradores)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Limpeza executada com sucesso

  /api/notifications/jobs/history:
    get:
      tags:
        - NotificationJobs
      summary: Histórico de execução dos jobs com filtros avançados
      description: Obtém o histórico de execução dos jobs de notificação com paginação e filtros avançados (apenas administradores)
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Número da página
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Limite de itens por página
          example: 20
        - name: jobType
          in: query
          schema:
            type: string
          description: Tipo de job para filtrar
          example: payment_check
        - name: status
          in: query
          schema:
            type: string
            enum: [success, error, running]
          description: Status para filtrar
          example: success
        - name: startDate
          in: query
          schema:
            type: string
            format: date
          description: Data de início para filtrar (YYYY-MM-DD)
          example: "2025-01-01"
        - name: endDate
          in: query
          schema:
            type: string
            format: date
          description: Data de fim para filtrar (YYYY-MM-DD)
          example: "2025-01-31"
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [startedAt, finishedAt, duration, notificationsCreated, notificationsUpdated, status]
            default: startedAt
          description: Campo para ordenação
          example: duration
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
            default: DESC
          description: Ordem de classificação
          example: DESC
        - name: minDuration
          in: query
          schema:
            type: integer
            minimum: 0
          description: Duração mínima em milissegundos
          example: 1000
        - name: maxDuration
          in: query
          schema:
            type: integer
            minimum: 0
          description: Duração máxima em milissegundos
          example: 10000
        - name: minNotifications
          in: query
          schema:
            type: integer
            minimum: 0
          description: Número mínimo de notificações criadas
          example: 5
        - name: hasError
          in: query
          schema:
            type: boolean
          description: Filtrar apenas execuções com erro
          example: false
      responses:
        '200':
          description: Histórico retornado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      history:
                        type: array
                        description: Lista de execuções
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 123
                            jobName:
                              type: string
                              example: payment_check
                            status:
                              type: string
                              enum: [success, error, running]
                              example: success
                            startedAt:
                              type: string
                              format: date-time
                              example: "2025-01-20T10:00:00Z"
                            finishedAt:
                              type: string
                              format: date-time
                              example: "2025-01-20T10:05:00Z"
                            duration:
                              type: integer
                              example: 300000
                            notificationsCreated:
                              type: integer
                              example: 15
                            notificationsUpdated:
                              type: integer
                              example: 3
                            errorMessage:
                              type: string
                              example: null
                            metadata:
                              type: object
                              example: {"usersProcessed": 25}
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 20
                          total:
                            type: integer
                            example: 150
                          totalPages:
                            type: integer
                            example: 8
                          hasNextPage:
                            type: boolean
                            example: true
                          hasPrevPage:
                            type: boolean
                            example: false
                          nextPage:
                            type: integer
                            example: 2
                          prevPage:
                            type: integer
                            example: null
                      filters:
                        type: object
                        properties:
                          applied:
                            type: object
                            description: Filtros aplicados
                            example: {"jobType": "payment_check", "status": "success"}
                          available:
                            type: object
                            properties:
                              jobTypes:
                                type: array
                                items:
                                  type: string
                                example: ["payment_check", "general_reminders", "cleanup"]
                              dateRange:
                                type: object
                                properties:
                                  minDate:
                                    type: string
                                    format: date-time
                                    example: "2024-01-01T00:00:00Z"
                                  maxDate:
                                    type: string
                                    format: date-time
                                    example: "2025-01-20T23:59:59Z"
                      stats:
                        type: object
                        properties:
                          totalCount:
                            type: integer
                            example: 150
                          successCount:
                            type: integer
                            example: 135
                          errorCount:
                            type: integer
                            example: 10
                          runningCount:
                            type: integer
                            example: 5
                          successRate:
                            type: number
                            example: 90.0
                          avgDuration:
                            type: integer
                            example: 2500
                          distribution:
                            type: object
                            properties:
                              success:
                                type: integer
                                example: 90
                              error:
                                type: integer
                                example: 7
                              running:
                                type: integer
                                example: 3
                  message:
                    type: string
                    example: "Histórico recuperado com sucesso. 150 execuções encontradas."
        '400':
          description: Parâmetros inválidos
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Parâmetros inválidos"
                  errors:
                    type: array
                    items:
                      type: string
                    example: ["Página deve ser um número positivo"]
        '401':
          description: Não autorizado
        '500':
          description: Erro interno do servidor

  /api/notifications/jobs/stats:
    get:
      tags:
        - NotificationJobs
      summary: Estatísticas dos jobs
      description: Obtém estatísticas detalhadas dos jobs de notificação
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas retornadas

  /api/notifications/jobs/stats/detailed:
    get:
      tags:
        - NotificationJobs
      summary: Estatísticas detalhadas por período
      description: Obtém estatísticas detalhadas por período
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas detalhadas retornadas

  /api/notifications/jobs/last-executions:
    get:
      tags:
        - NotificationJobs
      summary: Últimas execuções dos jobs
      description: Obtém as últimas execuções dos jobs
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Últimas execuções retornadas

  /api/notifications/jobs/run-all:
    post:
      tags:
        - NotificationJobs
      summary: Executar todos os jobs
      description: Executa todos os jobs de notificação
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Todos os jobs executados com sucesso

  /api/notifications/jobs/execution/{executionId}:
    get:
      tags:
        - NotificationJobs
      summary: Detalhes de execução de job
      description: Obtém detalhes completos de uma execução específica de job (apenas administradores)
      security:
        - bearerAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            type: integer
          description: ID da execução do job
          example: 123
      responses:
        '200':
          description: Detalhes da execução retornados com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      execution:
                        type: object
                        properties:
                          id:
                            type: integer
                            description: ID da execução
                            example: 123
                          jobName:
                            type: string
                            description: Nome do job
                            example: payment_check
                          status:
                            type: string
                            enum: [success, error, running]
                            description: Status da execução
                            example: success
                          startedAt:
                            type: string
                            format: date-time
                            description: Data/hora de início
                            example: "2025-01-20T10:00:00Z"
                          finishedAt:
                            type: string
                            format: date-time
                            description: Data/hora de término
                            example: "2025-01-20T10:05:00Z"
                          duration:
                            type: integer
                            description: Duração em milissegundos
                            example: 300000
                          notificationsCreated:
                            type: integer
                            description: Notificações criadas
                            example: 15
                          notificationsUpdated:
                            type: integer
                            description: Notificações atualizadas
                            example: 3
                          errorMessage:
                            type: string
                            description: Mensagem de erro (se houver)
                            example: "Falha na conexão com banco de dados"
                          errorStack:
                            type: string
                            description: Stack trace do erro (se houver)
                            example: "SequelizeConnectionError: Connection timeout"
                          metadata:
                            type: object
                            description: Metadados da execução
                            example: {"usersProcessed": 25, "paymentsChecked": 150}
                      stats:
                        type: object
                        properties:
                          isRunning:
                            type: boolean
                            description: Se o job está em execução
                            example: false
                          hasError:
                            type: boolean
                            description: Se houve erro na execução
                            example: false
                          durationFormatted:
                            type: string
                            description: Duração formatada
                            example: "300000ms"
                          timeSinceStart:
                            type: string
                            description: Tempo desde o início
                            example: "300s atrás"
                          totalNotifications:
                            type: integer
                            description: Total de notificações processadas
                            example: 18
                      relatedExecutions:
                        type: array
                        description: Execuções relacionadas do mesmo job
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              example: 122
                            status:
                              type: string
                              example: success
                            startedAt:
                              type: string
                              format: date-time
                              example: "2025-01-20T09:00:00Z"
                            duration:
                              type: integer
                              example: 250000
                            notificationsCreated:
                              type: integer
                              example: 12
                            hasError:
                              type: boolean
                              example: false
                            errorMessage:
                              type: string
                              example: null
                      analysis:
                        type: object
                        properties:
                          successRate:
                            type: integer
                            description: Taxa de sucesso (0-100)
                            example: 100
                          performance:
                            type: string
                            enum: [excellent, good, fair, poor, unknown]
                            description: Avaliação de performance
                            example: good
                          impact:
                            type: string
                            enum: [high, low]
                            description: Impacto da execução
                            example: high
                  message:
                    type: string
                    example: "Detalhes da execução 123 recuperados com sucesso"
        '400':
          description: ID de execução inválido
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "ID de execução inválido"
        '401':
          description: Não autorizado
        '404':
          description: Execução de job não encontrada
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                    example: "Execução de job não encontrada"

  # Endpoints de Metas de Investimento
  /api/investment-goals:
    get:
      tags:
        - InvestmentGoals
      summary: Listar metas de investimento
      description: Lista todas as metas de investimento do usuário
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [ativa, concluida, cancelada]
          description: Filtrar por status
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Página para paginação
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Limite de itens por página
      responses:
        '200':
          description: Lista de metas com paginação
          content:
            application/json:
              schema:
                type: object
                properties:
                  goals:
                    type: array
                    items:
                      $ref: '#/components/schemas/InvestmentGoal'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      pages:
                        type: integer
    post:
      tags:
        - InvestmentGoals
      summary: Criar meta de investimento
      description: Cria uma nova meta de investimento
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: Título da meta
                description:
                  type: string
                  description: Descrição da meta
                target_amount:
                  type: number
                  description: Valor alvo
                target_date:
                  type: string
                  format: date
                  description: Data alvo (YYYY-MM-DD)
                current_amount:
                  type: number
                  description: Valor atual (opcional)
                color:
                  type: string
                  description: Cor da meta (formato #RRGGBB)
                category_id:
                  type: integer
                  description: ID da categoria (opcional)
              required:
                - title
                - target_amount
                - target_date
      responses:
        '201':
          description: Meta criada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentGoal'

  /api/investment-goals/statistics:
    get:
      tags:
        - InvestmentGoals
      summary: Estatísticas das metas
      description: Obtém estatísticas das metas de investimento
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas retornadas

  /api/investment-goals/{id}:
    get:
      tags:
        - InvestmentGoals
      summary: Obter meta específica
      description: Obtém uma meta de investimento específica com progresso calculado
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Meta encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentGoal'
    put:
      tags:
        - InvestmentGoals
      summary: Atualizar meta
      description: Atualiza uma meta de investimento existente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                target_amount:
                  type: number
                target_date:
                  type: string
                  format: date
                current_amount:
                  type: number
                status:
                  type: string
                  enum: [ativa, concluida, cancelada]
                color:
                  type: string
                category_id:
                  type: integer
      responses:
        '200':
          description: Meta atualizada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvestmentGoal'
    delete:
      tags:
        - InvestmentGoals
      summary: Excluir meta
      description: Exclui uma meta de investimento
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Meta excluída com sucesso

  /api/investment-goals/{id}/amount:
    put:
      tags:
        - InvestmentGoals
      summary: Atualizar valor atual
      description: Atualiza o valor atual de uma meta
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                current_amount:
                  type: number
                  description: Valor atual
              required:
                - current_amount
      responses:
        '200':
          description: Valor atualizado com sucesso

  /api/investment-goals/{id}/calculate:
    put:
      tags:
        - InvestmentGoals
      summary: Calcular valor automaticamente
      description: Calcula automaticamente o valor atual da meta baseado nos investimentos
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Valor calculado e atualizado

  # Endpoints de Aportes de Investimento
  /api/investment-contributions:
    get:
      tags:
        - InvestmentContributions
      summary: Listar aportes
      description: Lista todos os aportes do usuário com filtros e paginação
      security:
        - bearerAuth: []
      parameters:
        - name: investment_id
          in: query
          schema:
            type: integer
          description: Filtrar por investimento
        - name: broker
          in: query
          schema:
            type: string
          description: Filtrar por corretora
        - name: start_date
          in: query
          schema:
            type: string
            format: date
          description: Data inicial
        - name: end_date
          in: query
          schema:
            type: string
            format: date
          description: Data final
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Página
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Limite por página
      responses:
        '200':
          description: Lista de aportes com paginação e estatísticas
    post:
      tags:
        - InvestmentContributions
      summary: Criar aporte
      description: Cria um novo aporte para um investimento
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                investment_id:
                  type: integer
                  description: ID do investimento
                contribution_date:
                  type: string
                  format: date
                  description: Data do aporte (YYYY-MM-DD)
                amount:
                  type: number
                  description: Valor total do aporte
                quantity:
                  type: number
                  description: Quantidade de ativos
                unit_price:
                  type: number
                  description: Preço unitário
                broker:
                  type: string
                  description: Corretora (opcional)
                observations:
                  type: string
                  description: Observações (opcional)
              required:
                - investment_id
                - contribution_date
                - amount
                - quantity
                - unit_price
      responses:
        '201':
          description: Aporte criado com sucesso

  /api/investment-contributions/statistics:
    get:
      tags:
        - InvestmentContributions
      summary: Estatísticas dos aportes
      description: Calcula estatísticas dos aportes do usuário
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas retornadas

  /api/investment-contributions/investment/{investmentId}:
    get:
      tags:
        - InvestmentContributions
      summary: Aportes por investimento
      description: Lista todos os aportes de um investimento específico
      security:
        - bearerAuth: []
      parameters:
        - name: investmentId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de aportes do investimento com resumo

  /api/investment-contributions/{id}:
    get:
      tags:
        - InvestmentContributions
      summary: Obter aporte específico
      description: Busca um aporte específico por ID
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Dados do aporte
    put:
      tags:
        - InvestmentContributions
      summary: Atualizar aporte
      description: Atualiza um aporte existente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                contribution_date:
                  type: string
                  format: date
                amount:
                  type: number
                quantity:
                  type: number
                unit_price:
                  type: number
                broker:
                  type: string
                observations:
                  type: string
      responses:
        '200':
          description: Aporte atualizado com sucesso
    delete:
      tags:
        - InvestmentContributions
      summary: Excluir aporte
      description: Exclui um aporte
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Aporte excluído com sucesso

  # Endpoints específicos de Recebíveis
  /api/receivables/upcoming-due:
    get:
      tags:
        - Receivables
      summary: Recebíveis a vencer
      description: Busca contas a vencer nos próximos dias
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de recebíveis a vencer

  /api/receivables/overdue:
    get:
      tags:
        - Receivables
      summary: Recebíveis vencidos
      description: Busca contas vencidas
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de recebíveis vencidos

  /api/receivables/{id}/payments:
    get:
      tags:
        - Receivables
      summary: Pagamentos de recebível
      description: Lista pagamentos de uma conta a receber
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de pagamentos
    post:
      tags:
        - Receivables
      summary: Registrar pagamento
      description: Registra um pagamento para uma conta a receber
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Pagamento registrado

  # Endpoints específicos de Pagáveis
  /api/payables/upcoming-due:
    get:
      tags:
        - Payables
      summary: Pagáveis a vencer
      description: Busca contas a vencer nos próximos dias
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de pagáveis a vencer

  /api/payables/overdue:
    get:
      tags:
        - Payables
      summary: Pagáveis vencidos
      description: Busca contas vencidas
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de pagáveis vencidos

  /api/payables/{id}/payments:
    get:
      tags:
        - Payables
      summary: Pagamentos de pagável
      description: Lista pagamentos de uma conta a pagar
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de pagamentos
    post:
      tags:
        - Payables
      summary: Adicionar pagamento
      description: Adiciona um pagamento a uma conta a pagar
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '201':
          description: Pagamento adicionado

  # Endpoints específicos de Clientes
  /api/customers/{id}/receivables:
    get:
      tags:
        - Customers
      summary: Recebíveis do cliente
      description: Busca contas a receber de um cliente específico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de recebíveis do cliente

  # Endpoints específicos de Transações
  /api/transactions/categories:
    get:
      tags:
        - Transactions
      summary: Categorias de transações
      description: Retorna categorias disponíveis para transações
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de categorias

  /api/transactions/summary:
    get:
      tags:
        - Transactions
      summary: Resumo de transações
      description: Retorna resumo das transações do usuário
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Resumo das transações

  /api/transactions/balance:
    get:
      tags:
        - Transactions
      summary: Saldo por período
      description: Retorna saldo das transações por período
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Saldo por período

  /api/transactions/{id}:
    get:
      tags:
        - Transactions
      summary: Obter transação
      description: Retorna uma transação específica
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Transação encontrada
    put:
      tags:
        - Transactions
      summary: Atualizar transação
      description: Atualiza uma transação existente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Transação atualizada
    delete:
      tags:
        - Transactions
      summary: Excluir transação
      description: Remove uma transação
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Transação removida

  # Endpoints específicos de Categorias
  /api/categories/{id}:
    put:
      tags:
        - Categories
      summary: Atualizar categoria
      description: |
        Atualiza uma categoria existente do usuário.
        
        **Atenção:**
        - Não é possível editar categorias padrão do sistema (`is_default: true`).
        - Apenas categorias personalizadas podem ser editadas.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                type:
                  type: string
                  enum: [income, expense]
                color:
                  type: string
      responses:
        '200':
          description: Categoria atualizada
    delete:
      tags:
        - Categories
      summary: Excluir categoria
      description: |
        Remove uma categoria personalizada do usuário.
        
        **Atenção:**
        - Não é possível excluir categorias padrão do sistema (`is_default: true`).
        - Apenas categorias personalizadas podem ser removidas.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Categoria removida

  # Endpoints de Financiamentos
  /api/financings:
    get:
      tags:
        - Financings
      summary: Listar financiamentos
      description: Lista todos os financiamentos do usuário com filtros e paginação
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Número da página
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Limite de itens por página
        - name: financing_type
          in: query
          schema:
            type: string
            enum: [hipoteca, emprestimo_pessoal, veiculo, outros]
          description: Filtrar por tipo de financiamento
        - name: creditor_id
          in: query
          schema:
            type: integer
          description: Filtrar por credor
        - name: status
          in: query
          schema:
            type: string
            enum: [ativo, quitado, inadimplente]
          description: Filtrar por status
        - name: amortization_method
          in: query
          schema:
            type: string
            enum: [SAC, Price]
          description: Filtrar por método de amortização
        - name: start_date_from
          in: query
          schema:
            type: string
            format: date
          description: Data de início a partir de
        - name: start_date_to
          in: query
          schema:
            type: string
            format: date
          description: Data de início até
      responses:
        '200':
          description: Lista de financiamentos
    post:
      tags:
        - Financings
      summary: Criar financiamento
      description: Cria um novo financiamento
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                creditor_id:
                  type: integer
                  description: ID do credor
                financing_type:
                  type: string
                  enum: [hipoteca, emprestimo_pessoal, veiculo, outros]
                  description: Tipo de financiamento
                total_amount:
                  type: number
                  minimum: 0.01
                  description: Valor total financiado
                interest_rate:
                  type: number
                  minimum: 0
                  description: Taxa de juros anual (decimal)
                term_months:
                  type: integer
                  minimum: 1
                  description: Prazo em meses
                start_date:
                  type: string
                  format: date
                  description: Data de início do financiamento
                description:
                  type: string
                  description: Descrição do financiamento
                contract_number:
                  type: string
                  description: Número do contrato
                payment_method:
                  type: string
                  enum: [boleto, debito_automatico, cartao, pix]
                  description: Método de pagamento
                observations:
                  type: string
                  description: Observações adicionais
                amortization_method:
                  type: string
                  enum: [SAC, Price]
                  description: Método de amortização
              required:
                - creditor_id
                - financing_type
                - total_amount
                - interest_rate
                - term_months
                - start_date
                - amortization_method
      responses:
        '201':
          description: Financiamento criado com sucesso

  /api/financings/statistics:
    get:
      tags:
        - Financings
      summary: Estatísticas dos financiamentos
      description: Obtém estatísticas dos financiamentos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas retornadas

  /api/financings/{id}:
    get:
      tags:
        - Financings
      summary: Obter financiamento
      description: Obtém um financiamento específico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Dados do financiamento
    put:
      tags:
        - Financings
      summary: Atualizar financiamento
      description: Atualiza um financiamento existente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Financiamento atualizado
    delete:
      tags:
        - Financings
      summary: Excluir financiamento
      description: Remove um financiamento
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Financiamento removido

  /api/financings/{id}/amortization-table:
    get:
      tags:
        - Financings
      summary: Tabela de amortização
      description: Obtém a tabela de amortização de um financiamento
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Tabela de amortização

  /api/financings/{id}/early-payment-simulation:
    post:
      tags:
        - Financings
      summary: Simular pagamento antecipado
      description: Simula um pagamento antecipado de um financiamento
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Simulação retornada

  # Endpoints de Pagamentos de Financiamentos
  /api/financing-payments:
    get:
      tags:
        - FinancingPayments
      summary: Listar pagamentos de financiamentos
      description: Lista todos os pagamentos do usuário com filtros e paginação
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Número da página
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
          description: Limite de itens por página
        - name: financing_id
          in: query
          schema:
            type: integer
          description: Filtrar por financiamento
        - name: account_id
          in: query
          schema:
            type: integer
          description: Filtrar por conta
        - name: payment_method
          in: query
          schema:
            type: string
            enum: [boleto, debito_automatico, cartao, pix, transferencia]
          description: Filtrar por método de pagamento
        - name: payment_type
          in: query
          schema:
            type: string
            enum: [parcela, parcial, antecipado]
          description: Filtrar por tipo de pagamento
        - name: status
          in: query
          schema:
            type: string
            enum: [pago, pendente, atrasado]
          description: Filtrar por status
        - name: payment_date_from
          in: query
          schema:
            type: string
            format: date
          description: Data de pagamento a partir de
        - name: payment_date_to
          in: query
          schema:
            type: string
            format: date
          description: Data de pagamento até
      responses:
        '200':
          description: Lista de pagamentos
    post:
      tags:
        - FinancingPayments
      summary: Criar pagamento de financiamento
      description: Cria um novo pagamento de financiamento
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                financing_id:
                  type: integer
                  description: ID do financiamento
                account_id:
                  type: integer
                  description: ID da conta
                installment_number:
                  type: integer
                  minimum: 1
                  description: Número da parcela
                payment_amount:
                  type: number
                  minimum: 0.01
                  description: Valor total do pagamento
                principal_amount:
                  type: number
                  minimum: 0
                  description: Valor da amortização
                interest_amount:
                  type: number
                  minimum: 0
                  description: Valor dos juros
                payment_date:
                  type: string
                  format: date
                  description: Data do pagamento
                payment_method:
                  type: string
                  enum: [boleto, debito_automatico, cartao, pix, transferencia]
                  description: Método de pagamento
                payment_type:
                  type: string
                  enum: [parcela, parcial, antecipado]
                  default: parcela
                  description: Tipo de pagamento
                observations:
                  type: string
                  description: Observações do pagamento
              required:
                - financing_id
                - account_id
                - installment_number
                - payment_amount
                - principal_amount
                - interest_amount
                - payment_date
                - payment_method
      responses:
        '201':
          description: Pagamento registrado com sucesso

  /api/financing-payments/{id}:
    get:
      tags:
        - FinancingPayments
      summary: Obter pagamento específico
      description: Obtém um pagamento específico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Dados do pagamento
    put:
      tags:
        - FinancingPayments
      summary: Atualizar pagamento
      description: Atualiza um pagamento existente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Pagamento atualizado
    delete:
      tags:
        - FinancingPayments
      summary: Excluir pagamento
      description: Remove um pagamento
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Pagamento removido

  /api/financing-payments/{id}/pay:
    post:
      tags:
        - FinancingPayments
      summary: Pagar parcela
      description: Marca uma parcela como paga
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Parcela marcada como paga

  /api/financing-payments/early-payment:
    post:
      tags:
        - FinancingPayments
      summary: Registrar pagamento antecipado
      description: Registra um pagamento antecipado
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Pagamento antecipado registrado

  # Endpoints de Credores
  /api/creditors:
    get:
      tags:
        - Creditors
      summary: Listar credores
      description: Lista todos os credores do usuário
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de credores
    post:
      tags:
        - Creditors
      summary: Criar credor
      description: Cria um novo credor
      security:
        - bearerAuth: []
      responses:
        '201':
          description: Credor criado

  /api/creditors/{id}:
    get:
      tags:
        - Creditors
      summary: Obter credor
      description: Obtém um credor específico
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Dados do credor
    put:
      tags:
        - Creditors
      summary: Atualizar credor
      description: Atualiza um credor existente
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Credor atualizado
    delete:
      tags:
        - Creditors
      summary: Excluir credor
      description: Remove um credor
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Credor removido

  # Endpoints de Integridade de Dados (Admin)
  /api/data-integrity:
    get:
      tags:
        - DataIntegrity
      summary: Verificar integridade dos dados
      description: Executa verificação completa de integridade dos dados do sistema
      security:
        - bearerAuth: []
      parameters:
        - name: autoFix
          in: query
          schema:
            type: boolean
            default: false
          description: Se deve corrigir automaticamente problemas simples
        - name: sendAlert
          in: query
          schema:
            type: boolean
            default: true
          description: Se deve enviar alertas por email para problemas críticos
      responses:
        '200':
          description: Verificação de integridade concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  results:
                    type: object
                    properties:
                      orphanedNotifications:
                        type: integer
                        description: Número de notificações órfãs encontradas
                      duplicateNotifications:
                        type: integer
                        description: Número de notificações duplicadas encontradas
                      inconsistentNotifications:
                        type: integer
                        description: Número de notificações inconsistentes encontradas
                      orphanedTransactions:
                        type: integer
                        description: Número de transações órfãs encontradas
                      autoFixed:
                        type: integer
                        description: Número de problemas corrigidos automaticamente
                      criticalIssues:
                        type: integer
                        description: Número de problemas críticos que requerem intervenção manual
                  timestamp:
                    type: string
                    format: date-time
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/data-integrity/notifications:
    get:
      tags:
        - DataIntegrity
      summary: Verificar integridade das notificações
      description: Executa verificação específica de integridade das notificações
      security:
        - bearerAuth: []
      parameters:
        - name: autoFix
          in: query
          schema:
            type: boolean
            default: false
          description: Se deve corrigir automaticamente problemas simples
      responses:
        '200':
          description: Verificação de notificações concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  orphanedNotifications:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        userId:
                          type: integer
                        type:
                          type: string
                        message:
                          type: string
                  duplicateNotifications:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        userId:
                          type: integer
                        type:
                          type: string
                        message:
                          type: string
                  inconsistentNotifications:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        userId:
                          type: integer
                        type:
                          type: string
                        message:
                          type: string
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/data-integrity/transactions:
    get:
      tags:
        - DataIntegrity
      summary: Verificar integridade das transações
      description: Executa verificação específica de integridade das transações
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Verificação de transações concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  orphanedTransactions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        description:
                          type: string
                        amount:
                          type: number
                        categoryId:
                          type: integer
                        categoryName:
                          type: string
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/data-integrity/statistics:
    get:
      tags:
        - DataIntegrity
      summary: Obter estatísticas de integridade
      description: Retorna estatísticas sobre a integridade dos dados
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas de integridade
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalNotifications:
                    type: integer
                    description: Total de notificações no sistema
                  activeNotifications:
                    type: integer
                    description: Notificações ativas
                  totalTransactions:
                    type: integer
                    description: Total de transações no sistema
                  transactionsWithValidCategories:
                    type: integer
                    description: Transações com categorias válidas
                  lastIntegrityCheck:
                    type: string
                    format: date-time
                    description: Data da última verificação de integridade
                  issuesFound:
                    type: integer
                    description: Problemas encontrados na última verificação
                  autoFixedIssues:
                    type: integer
                    description: Problemas corrigidos automaticamente
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  # Endpoints de Configuração de Jobs (Admin)
  /api/job-scheduler/configs:
    get:
      tags:
        - JobScheduler
      summary: Obter todas as configurações de jobs
      description: Retorna todas as configurações de jobs cron do sistema
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Configurações obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      configs:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            expression:
                              type: string
                              description: Expressão cron do job
                            enabled:
                              type: boolean
                              description: Se o job está habilitado
                            description:
                              type: string
                              description: Descrição do job
                      totalJobs:
                        type: integer
                        description: Total de jobs configurados
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-scheduler/configs/{jobName}:
    get:
      tags:
        - JobScheduler
      summary: Obter configuração de um job específico
      description: Retorna a configuração de um job cron específico
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job (payment_check, general_reminders, cleanup, data_integrity)
      responses:
        '200':
          description: Configuração obtida com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      jobName:
                        type: string
                      config:
                        type: object
                        properties:
                          expression:
                            type: string
                          enabled:
                            type: boolean
                          description:
                            type: string
        '404':
          description: Job não encontrado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)
    put:
      tags:
        - JobScheduler
      summary: Atualizar configuração de um job
      description: Atualiza a configuração de um job cron específico
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expression:
                  type: string
                  description: Nova expressão cron (opcional)
                  example: "0 */4 * * *"
                enabled:
                  type: boolean
                  description: Se o job deve estar habilitado (opcional)
                  example: true
                description:
                  type: string
                  description: Nova descrição (opcional)
                  example: "Verificação de pagamentos a cada 4 horas"
      responses:
        '200':
          description: Configuração atualizada com sucesso
        '400':
          description: Expressão cron inválida
        '404':
          description: Job não encontrado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-scheduler/status:
    get:
      tags:
        - JobScheduler
      summary: Obter status dos jobs
      description: Retorna o status atual de todos os jobs cron
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Status obtido com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      status:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            enabled:
                              type: boolean
                            active:
                              type: boolean
                            expression:
                              type: string
                            description:
                              type: string
                            nextRun:
                              type: string
                              format: date-time
                      totalJobs:
                        type: integer
                      activeJobs:
                        type: integer
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-scheduler/jobs/{jobName}/stop:
    post:
      tags:
        - JobScheduler
      summary: Parar um job específico
      description: Para a execução de um job cron específico
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job
      responses:
        '200':
          description: Job parado com sucesso
        '404':
          description: Job não encontrado ou já parado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-scheduler/jobs/stop-all:
    post:
      tags:
        - JobScheduler
      summary: Parar todos os jobs
      description: Para a execução de todos os jobs cron ativos
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Todos os jobs parados com sucesso
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-scheduler/validate-cron:
    post:
      tags:
        - JobScheduler
      summary: Validar expressão cron
      description: Valida se uma expressão cron é válida
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expression:
                  type: string
                  description: Expressão cron a ser validada
                  example: "0 */6 * * *"
              required:
                - expression
      responses:
        '200':
          description: Validação concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      expression:
                        type: string
                      valid:
                        type: boolean
        '400':
          description: Expressão cron não fornecida
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-scheduler/cron-examples:
    get:
      tags:
        - JobScheduler
      summary: Obter exemplos de expressões cron
      description: Retorna exemplos comuns de expressões cron com explicações
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Exemplos obtidos com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      examples:
                        type: array
                        items:
                          type: object
                          properties:
                            expression:
                              type: string
                              example: "0 */6 * * *"
                            description:
                              type: string
                              example: "A cada 6 horas"
                            explanation:
                              type: string
                              example: "Executa a cada 6 horas (00:00, 06:00, 12:00, 18:00)"
                      totalExamples:
                        type: integer
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  # Endpoints de Painel Administrativo de Jobs (Admin)
  /api/job-admin/dashboard:
    get:
      tags:
        - JobAdmin
      summary: Obter painel administrativo de jobs
      description: Retorna o painel administrativo completo com status, configurações e histórico dos jobs
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dashboard obtido com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      jobsStatus:
                        type: object
                        description: Status atual de todos os jobs
                      jobsConfigs:
                        type: object
                        description: Configurações de todos os jobs
                      recentExecutions:
                        type: array
                        description: Últimas 10 execuções de jobs
                      stats:
                        type: object
                        description: Estatísticas gerais dos jobs
                      totalJobs:
                        type: integer
                      activeJobs:
                        type: integer
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-admin/jobs/{jobName}/pause:
    post:
      tags:
        - JobAdmin
      summary: Pausar um job específico
      description: Pausa a execução de um job cron específico
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job
      responses:
        '200':
          description: Job pausado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      jobName:
                        type: string
                      status:
                        type: string
                        example: "paused"
        '404':
          description: Job não encontrado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-admin/jobs/{jobName}/resume:
    post:
      tags:
        - JobAdmin
      summary: Retomar um job pausado
      description: Retoma a execução de um job cron pausado
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job
      responses:
        '200':
          description: Job retomado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      jobName:
                        type: string
                      status:
                        type: string
                        example: "resumed"
        '404':
          description: Job não encontrado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-admin/jobs/{jobName}/execute:
    post:
      tags:
        - JobAdmin
      summary: Executar job manualmente
      description: Executa um job manualmente, independente do agendamento
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: integer
                  description: ID do usuário (opcional, para jobs específicos de usuário)
                  example: 123
      responses:
        '200':
          description: Job executado manualmente com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      jobName:
                        type: string
                      userId:
                        type: integer
                      executedAt:
                        type: string
                        format: date-time
        '400':
          description: Job não suporta execução manual
        '404':
          description: Job não encontrado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-admin/executions/{executionId}:
    get:
      tags:
        - JobAdmin
      summary: Obter detalhes de uma execução
      description: Retorna detalhes completos de uma execução específica de job
      security:
        - bearerAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            type: integer
          description: ID da execução
      responses:
        '200':
          description: Detalhes da execução obtidos com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      execution:
                        type: object
                        description: Dados da execução
                      logs:
                        type: array
                        description: Logs relacionados à execução
                      metadata:
                        type: object
                        properties:
                          duration:
                            type: integer
                          status:
                            type: string
                          createdAt:
                            type: string
                            format: date-time
                          updatedAt:
                            type: string
                            format: date-time
        '404':
          description: Execução não encontrada
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-admin/users/{userId}/reprocess:
    post:
      tags:
        - JobAdmin
      summary: Reprocessar notificações de um usuário
      description: Reprocessa notificações para um usuário específico
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: ID do usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                jobType:
                  type: string
                  enum: [payment_check, general_reminders]
                  description: Tipo de job para reprocessar
                  example: "payment_check"
              required:
                - jobType
      responses:
        '200':
          description: Notificações reprocessadas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      jobType:
                        type: string
                      reprocessedAt:
                        type: string
                        format: date-time
        '400':
          description: Parâmetros inválidos
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/job-admin/jobs/{jobName}/stats:
    get:
      tags:
        - JobAdmin
      summary: Obter estatísticas detalhadas de um job
      description: Retorna estatísticas detalhadas de um job específico
      security:
        - bearerAuth: []
      parameters:
        - name: jobName
          in: path
          required: true
          schema:
            type: string
          description: Nome do job
        - name: period
          in: query
          schema:
            type: string
            enum: [day, week, month]
            default: week
          description: Período para as estatísticas
      responses:
        '200':
          description: Estatísticas obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      jobName:
                        type: string
                      period:
                        type: string
                      stats:
                        type: object
                        description: Estatísticas detalhadas do job
        '404':
          description: Job não encontrado
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  # Endpoints de Permissões
  /api/permissions:
    get:
      tags:
        - Permissions
      summary: Obter todas as permissões do sistema
      description: Retorna todas as permissões disponíveis no sistema, agrupadas por recurso
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Permissões obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      permissions:
                        type: object
                        description: Permissões agrupadas por recurso
                      totalPermissions:
                        type: integer
                      totalResources:
                        type: integer
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/permissions/me:
    get:
      tags:
        - Permissions
      summary: Obter permissões do usuário atual
      description: Retorna as permissões do usuário autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Permissões obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                      totalPermissions:
                        type: integer
        '401':
          description: Não autorizado

  /api/permissions/stats:
    get:
      tags:
        - Permissions
      summary: Obter estatísticas de permissões
      description: Retorna estatísticas de permissões por role
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      stats:
                        type: object
                        properties:
                          byRole:
                            type: object
                          totalResources:
                            type: integer
                          totalActions:
                            type: integer
                          resources:
                            type: array
                            items:
                              type: string
                          actions:
                            type: array
                            items:
                              type: string
                      totalPermissions:
                        type: integer
                      totalRoles:
                        type: integer
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/permissions/users/{userId}:
    get:
      tags:
        - Permissions
      summary: Obter permissões de um usuário específico
      description: Retorna as permissões de um usuário específico
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: ID do usuário
      responses:
        '200':
          description: Permissões obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                      totalPermissions:
                        type: integer
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado

  /api/permissions/users/{userId}/check:
    get:
      tags:
        - Permissions
      summary: Verificar permissão específica de um usuário
      description: Verifica se um usuário tem uma permissão específica
      security:
        - bearerAuth: []
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
          description: ID do usuário
        - name: resource
          in: query
          required: true
          schema:
            type: string
          description: Recurso a ser verificado
        - name: action
          in: query
          required: true
          schema:
            type: string
          description: Ação a ser verificada
      responses:
        '200':
          description: Verificação concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      resource:
                        type: string
                      action:
                        type: string
                      hasPermission:
                        type: boolean
                      role:
                        type: string
        '400':
          description: Parâmetros inválidos
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Usuário não encontrado

  /api/permissions/check-multiple:
    post:
      tags:
        - Permissions
      summary: Verificar múltiplas permissões
      description: Verifica múltiplas permissões de uma vez
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                permissions:
                  type: array
                  items:
                    type: array
                    items:
                      type: string
                    minItems: 2
                    maxItems: 2
                  description: Array de permissões [resource, action]
                  example: [["users", "read"], ["users", "write"]]
              required:
                - permissions
      responses:
        '200':
          description: Verificação concluída
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      role:
                        type: string
                      results:
                        type: array
                        items:
                          type: object
                          properties:
                            resource:
                              type: string
                            action:
                              type: string
                            hasPermission:
                              type: boolean
                      summary:
                        type: object
                        properties:
                          totalChecked:
                            type: integer
                          totalGranted:
                            type: integer
                          totalDenied:
                            type: integer
        '400':
          description: Parâmetros inválidos
        '401':
          description: Não autorizado

  # ========================================
  # ADMIN USERS ENDPOINTS
  # ========================================

  /api/admin/users:
    get:
      tags:
        - Admin Users
      summary: Listar usuários (apenas administradores)
      description: |
        Lista todos os usuários do sistema com paginação e filtros.
        Apenas administradores podem acessar este endpoint.
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Número da página
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Itens por página
        - name: search
          in: query
          schema:
            type: string
          description: Termo de busca por nome ou email
        - name: role
          in: query
          schema:
            type: string
            enum: [admin, user]
          description: Filtrar por role
      responses:
        '200':
          description: Lista de usuários obtida com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                          totalPages:
                            type: integer
                          totalItems:
                            type: integer
                          itemsPerPage:
                            type: integer
                          hasNextPage:
                            type: boolean
                          hasPrevPage:
                            type: boolean
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/admin/users/stats:
    get:
      tags:
        - Admin Users
      summary: Obter estatísticas de usuários (apenas administradores)
      description: |
        Retorna estatísticas gerais sobre os usuários do sistema.
        Apenas administradores podem acessar este endpoint.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estatísticas obtidas com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      totalUsers:
                        type: integer
                        description: Total de usuários no sistema
                      adminUsers:
                        type: integer
                        description: Número de usuários administradores
                      regularUsers:
                        type: integer
                        description: Número de usuários regulares
                      newUsersThisMonth:
                        type: integer
                        description: Novos usuários no mês atual
                      newUsersThisWeek:
                        type: integer
                        description: Novos usuários na semana atual
                      usersWith2FA:
                        type: integer
                        description: Usuários com autenticação de dois fatores
                      monthlyDistribution:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                              description: Mês no formato YYYY-MM
                            count:
                              type: integer
                              description: Número de usuários criados no mês
                        description: Distribuição de usuários por mês (últimos 12 meses)
                      lastUpdated:
                        type: string
                        format: date-time
                        description: Data da última atualização das estatísticas
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)

  /api/admin/users/{id}/status:
    put:
      tags:
        - Admin Users
      summary: Ativar/desativar usuário (apenas administradores)
      description: |
        Ativa ou desativa um usuário no sistema.
        Apenas administradores podem acessar este endpoint.
        Não é possível desativar sua própria conta.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID do usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                active:
                  type: boolean
                  description: Status desejado (true = ativo, false = inativo)
              required:
                - active
      responses:
        '200':
          description: Status do usuário alterado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      active:
                        type: boolean
        '400':
          description: Dados inválidos ou tentativa de desativar própria conta
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)
        '404':
          description: Usuário não encontrado

  /api/admin/users/{id}/role:
    put:
      tags:
        - Admin Users
      summary: Alterar role do usuário (apenas administradores)
      description: |
        Altera o role de um usuário (admin/user).
        Apenas administradores podem acessar este endpoint.
        Não é possível alterar seu próprio role.
        Não é possível remover o último administrador do sistema.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID do usuário
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [admin, user]
                  description: Novo role do usuário
              required:
                - role
      responses:
        '200':
          description: Role do usuário alterado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
                      role:
                        type: string
        '400':
          description: Role inválido ou tentativa de alterar próprio role
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)
        '404':
          description: Usuário não encontrado

  /api/admin/users/{id}:
    delete:
      tags:
        - Admin Users
      summary: Excluir usuário (apenas administradores)
      description: |
        Exclui um usuário permanentemente do sistema.
        Apenas administradores podem acessar este endpoint.
        Não é possível excluir sua própria conta.
        Não é possível excluir usuários com dados associados.
        Não é possível excluir o último administrador do sistema.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID do usuário
      responses:
        '200':
          description: Usuário excluído com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      userId:
                        type: integer
        '400':
          description: Tentativa de excluir própria conta ou usuário com dados associados
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado (apenas administradores)
        '404':
          description: Usuário não encontrado

    InvestmentContribution:
      type: object
      properties:
        id:
          type: integer
          description: ID único do aporte
        user_id:
          type: integer
          description: ID do usuário proprietário
        investment_id:
          type: integer
          description: ID do investimento
        contribution_date:
          type: string
          format: date
          description: Data do aporte (YYYY-MM-DD)
        amount:
          type: number
          format: float
          description: Valor total do aporte
        quantity:
          type: number
          format: float
          description: Quantidade de ativos
        unit_price:
          type: number
          format: float
          description: Preço unitário
        broker:
          type: string
          enum: [xp_investimentos, rico_investimentos, clear_corretora, modal_mais, inter_invest, nubank_invest, itau_corretora, bradesco_corretora, santander_corretora, outros]
          description: Corretora utilizada
        observations:
          type: string
          description: Observações adicionais
        source_account_id:
          type: integer
          description: ID da conta bancária de origem do aporte
        destination_account_id:
          type: integer
          description: ID da conta bancária de destino do aporte
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - investment_id
        - contribution_date
        - amount
        - quantity
        - unit_price
        - source_account_id
        - destination_account_id